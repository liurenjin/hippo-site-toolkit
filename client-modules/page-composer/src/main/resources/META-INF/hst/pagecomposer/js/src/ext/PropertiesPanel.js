Ext.namespace("Hippo.App");Hippo.App.PropertiesPanel=Ext.extend(Ext.FormPanel,{initComponent:function(){Ext.apply(this,{autoHeight:true,border:false,padding:10,autoScroll:true,labelWidth:100,labelSeparator:"",defaults:{width:170,anchor:"100%"},buttons:[{text:"Save",hidden:true,handler:this.submitForm,scope:this},{text:"Reset",scope:this,hidden:true,handler:function(){this.reload(this.siteId,this.id)}}]});Hippo.App.PropertiesPanel.superclass.initComponent.apply(this,arguments)},submitForm:function(){this.getForm().submit({url:"_rp/"+this.id+"./parameters",method:"POST",waitMsg:"Saving properties ...",success:function(){Ext.Msg.wait("Refreshing page ...");var a=Ext.getCmp("Iframe");a.setSrc(a.getFrameDocument().location.href)}})},onRender:function(){Hippo.App.PropertiesPanel.superclass.onRender.apply(this,arguments)},createDocument:function(c,d,a){var e="_rp/"+this.siteId+"./create";var b=new Ext.Window({title:"Create a new document",height:150,width:400,modal:true,items:[{xtype:"form",height:150,padding:10,labelWidth:120,id:"createDocumentForm",defaults:{labelSeparator:"",anchor:"100%"},items:[{xtype:"textfield",fieldLabel:"Document Name",allowBlank:false},{xtype:"textfield",disabled:true,fieldLabel:"Document Location",value:a.docLocation}]}],layout:"fit",buttons:[{text:"Create Document",handler:function(){var f=Ext.getCmp("createDocumentForm").getForm();f.submit();a.docName=f.items.get(0).getValue();if(a.docName==""){return}b.hide();Ext.Msg.wait("Creating Document ... ");Ext.Ajax.request({url:e,params:a,success:function(){Ext.Msg.hide();Ext.getCmp(a.comboId).setValue(a.docLocation+"/"+a.docName);Ext.Msg.wait("Refreshing page ... ");var g=Ext.getCmp("Iframe");g.setSrc(g.getFrameDocument().location.href)}})}}]});b.addButton({text:"Cancel"},function(){this.hide()},b);b.show()},loadProperties:function(b,a,c){this.removeAll();var e=a.length;if(e==0){this.add({html:"<div style='padding:5px' align='center'>No editable properties found for this component</div>",xtype:"panel",autoWidth:true,layout:"fit"});this.buttons[0].hide();this.buttons[1].hide()}else{for(var d=0;d<e;++d){var g=a[d];if(g.get("type")=="combo"){var f=new Ext.data.JsonStore({root:"data",url:"_rp/"+this.siteId+"./documents/"+g.get("docType"),fields:["path"]});var h=this.add({fieldLabel:g.get("label"),xtype:g.get("type"),allowBlank:!g.get("required"),name:g.get("name"),value:g.get("value"),store:f,forceSelection:true,triggerAction:"all",displayField:"path",valueField:"path"});if(g.get("allowCreation")){this.add({bodyCfg:{tag:"div",cls:"create-document-link",html:'Or <a href="#" id="combo'+d+'" >&nbsp;Create Document&nbsp;</a>&nbsp;'},border:false});this.doLayout(false,true);Ext.get("combo"+d).on("click",this.createDocument,this,{docType:g.get("docType"),docLocation:g.get("docLocation"),comboId:h.id})}}else{this.add({fieldLabel:g.get("label"),xtype:g.get("type"),value:g.get("value"),allowBlank:!g.get("required"),name:g.get("name")})}}this.buttons[0].show();this.buttons[1].show()}this.doLayout(false,true);this.getForm().clearInvalid()},loadException:function(d,e,f,c,b){console.dir(arguments);this.removeAll();var a="Error during "+f+". ";if(e=="response"){a+="\nServer returned statusText: "+b.statusText+", statusCode: "+b.status+" for request.url="+c.url}this.add({xtype:"label",text:a,fieldLabel:"Error information"});this.doLayout(false,true)},reload:function(d,e,b,c){this.siteId=d;this.id=e;var a=new Ext.data.JsonStore({autoLoad:true,method:"GET",root:"properties",fields:["name","value","label","required","description","docType","type","docLocation","allowCreation"],url:"_rp/"+e+"./parameters"});a.on("load",this.loadProperties,this);a.on("exception",this.loadException,this)}});Ext.reg("h_properties_panel",Hippo.App.PropertiesPanel);Ext.apply(Ext.layout.FormLayout.prototype,{originalRenderItem:Ext.layout.FormLayout.prototype.renderItem,renderItem:function(d,a,b){if(d&&!d.rendered&&d.isFormField&&d.fieldLabel&&d.allowBlank===false){d.fieldLabel=d.fieldLabel+' <span class="req">*</span>'}this.originalRenderItem.apply(this,arguments)}});